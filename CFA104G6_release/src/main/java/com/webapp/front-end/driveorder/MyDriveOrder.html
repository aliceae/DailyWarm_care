<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="description" content="" />
<meta name="author" content="" />
<title>Daily Warmæˆ‘çš„æ´¾è»Šè¨‚å–®</title>
<!-- Favicon-->
<link rel="icon" type="image/x-icon" href="assets/healthcare.png" />
<!-- Bootstrap Icons-->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
	rel="stylesheet" />
<link
	href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css"
	rel="stylesheet" />
<!-- Font Awesome icons (free version)-->
<script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"
	crossorigin="anonymous"></script>
<script src="http://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://kit.fontawesome.com/19fb92fb24.js" crossorigin="anonymous"></script>
<!-- Google fonts-->
<link
	href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700"
	rel="stylesheet" />
<link
	href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic"
	rel="stylesheet" type="text/css" />
<!-- SimpleLightbox plugin CSS-->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css"
	rel="stylesheet" />
<!-- Core theme CSS (includes Bootstrap)-->
<link href="../css/styles.css" rel="stylesheet" />
<style>
	.mybtn{
		width:100%;
		background-color:#fae1a7
	}

	i{
		color:#9e5b20
	}
	th{
		color:#9e5b20;
		background:#f5e7ba;
		border:1px solid white;
	}
	td{
		background:#f7efd2;
		border:1px solid white;
	}
	.card-header{
		background-color:#f5e7ba
	}
	.card-body{
		background-color:#f7efd2
	}
	

</style>


</head>

<body id="page-top">
	<!-- Navigation å°è¦½åˆ— -->
	<nav class="navbar navbar-expand-lg navbar-light fixed-top1 py-3"
		id="mainNav">
		<div class="container px-4 px-lg-0">
			<a class="navbar-brand" href="../AfterLogin.html">Daily Warm</a>
			<button class="navbar-toggler navbar-toggler-right" type="button"
				data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
				aria-controls="navbarResponsive" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav ms-auto my-2 my-lg-0">

					<!-- é¦–é  -->
					<li class="nav-item"><a class="nav-link" href="#">é¦–é </a></li>
					<!-- é—œæ–¼æˆ‘å€‘ -->
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-bs-toggle="dropdown" aria-expanded="false">
							é—œæ–¼æˆ‘å€‘ </a>
						<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
							<li><a class="dropdown-item" href="#">æœ€æ–°æ¶ˆæ¯</a></li>
							<li><a class="dropdown-item" href="#">ç¶²ç«™ç°¡ä»‹</a></li>
							<li><a class="dropdown-item" href="#">å¸¸è¦‹å•é¡Œ</a></li>
						</ul></li>
					<!-- æœå‹™é …ç›® -->
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-bs-toggle="dropdown" aria-expanded="false">
							æœå‹™é …ç›® </a>
						<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
							<li><a class="dropdown-item" href="#">ç…§è­·</a></li>
							<li><a class="dropdown-item" href="#">é¤é»</a></li>
							<li><a class="dropdown-item" href="#">æ´¾è»Š</a></li>
						</ul></li>
					<!-- é€šçŸ¥ -->
					<li class="nav-item"><a class="nav-link" href="#">é€šçŸ¥</a></li>
					<!-- æœƒå“¡ -->
					<li class="nav-item dropdown"><a class="nav-link"
						id="navbarDropdown" role="button" data-bs-toggle="dropdown"
						aria-expanded="false"> <i class="fas fa-user-circle fa-2x "></i>
					</a>
						<ul class="dropdown-menu" aria-labelledby="navbarDropdown">
							<li><a class="dropdown-item" href="#">åˆ‡æ›å¸³è™Ÿ</a></li>
							<li><a class="dropdown-item" href="#">ç”³è«‹æˆç‚ºç…§è­·å“¡</a></li>
							<li><a class="dropdown-item" href="#">ç™»å‡º</a></li>
						</ul></li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- Masthead ABOUT US -->
	<!-- Services æœå‹™å…§å®¹ -->
	<section class="page-section" id="portfolio" style="margin-top: 50px;background-color:#f1d683">
		<div class="container-fluid">

			<!-- Page Heading -->
			<h1 class="h3 mb-2 text-gray-800">æˆ‘çš„æ´¾è»Šè¨‚å–®</h1>
			<!-- DataTales Example -->
			<div class="card shadow mb-4">
				<div class="card-header py-3"
					style="justify-content: space-between; display: flex">
					<select style="border-radius: 0.35rem" id="selectStatus">
						<option value="7">æ‰€æœ‰è¨‚å–®</option>
						<option value="0">å¾…åŸ·è¡Œ</option>
						<option value="1">åŸ·è¡Œä¸­</option>
						<option value="2">å·²å®Œæˆ</option>
						<option value="3">å·²çµå–®</option>
						<option value="4">å–æ¶ˆç”³è«‹ä¸­</option>
						<option value="5">å·²å–æ¶ˆ</option>
					</select> <input type=date id="searchDate">
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-bordered" id="dataTable" width="100%"
							cellspacing="0" style="text-align:center">
							<thead>
								<tr>
									<th><i class="fa-solid fa-list-ol"></i> è¨‚å–®ID</th>
									<th><i class="fa-solid fa-calendar-check"></i> æ¥é€æ—¥æœŸ</th>
									<th><i class="fa-solid fa-clock"></i> æ¥é€æ™‚é–“</th>
									<th><i class="fa-solid fa-comment-dollar"></i> è¨‚å–®é‡‘é¡</th>
									<th><i class="fa-solid fa-circle-info"></i> è¨‚å–®ç‹€æ…‹</th>
									<th><i class="fa-solid fa-comment"></i> å‚™è¨»</th>
									<th><i class="fa-solid fa-rectangle-xmark"></i> å–æ¶ˆ</th>
									<th><i class="fa-solid fa-clipboard-list"></i> æ˜ç´°</th>
								</tr>
							</thead>
							<tfoot>
								<tr>
									<th><i class="fa-solid fa-list-ol"></i> è¨‚å–®ID</th>
									<th><i class="fa-solid fa-calendar-check"></i> æ¥é€æ—¥æœŸ</th>
									<th><i class="fa-solid fa-clock"></i> æ¥é€æ™‚é–“</th>
									<th><i class="fa-solid fa-comment-dollar"></i> è¨‚å–®é‡‘é¡</th>
									<th><i class="fa-solid fa-circle-info"></i> è¨‚å–®ç‹€æ…‹</th>
									<th><i class="fa-solid fa-comment"></i> å‚™è¨»</th>
									<th><i class="fa-solid fa-rectangle-xmark"></i> å–æ¶ˆ</th>
									<th><i class="fa-solid fa-clipboard-list"></i> æ˜ç´°</th>
								</tr>
							</tfoot>
							<tbody>
							</tbody>
						</table>
					</div>
					<div Id="orderInfo"></div>
				</div>
			</div>
		</div>
	</section>

	<!-- Footer -->
	<footer class="bg-light py-5">
		<div class="container px-4 px-lg-5">
			<div class="small text-center text-muted">Copyright &copy; 2021
				- Daily Warm</div>
		</div>
	</footer>
	<!-- Bootstrap core JS-->
	<!-- SimpleLightbox plugin JS-->
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
	<!-- Core theme JS-->
	<script src="http://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    
	
	<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
	<!-- * *                               SB Forms JS                               * *-->
	<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
	<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
	<!-- <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script> -->
</body>

<script>
$(document).ready(function () {
	$.ajax({
        url: "driveorder.do?search=memSort", /*GETæ ¼å¼*/
        type: "GET",
        success: function (data) {
            getData(data);
        }
    });
});
$("#selectStatus").change(function () {
	$("#searchDate").val("");
    $.ajax({
        url: "driveorder.do?search=memStus"+$("#selectStatus").val(), /*GETæ ¼å¼*/
        type: "GET",
        success: function (data) {
            getData(data);
        }
    });
});

$("#searchDate").change(function () {
	$("#selectStatus").val("7");
    $.ajax({
        url: "driveorder.do?search=memSort", /*GETæ ¼å¼*/
        type: "GET",
        success: function (data) {
            getData(data);
        }
    });
});

function getData(data) {
	if($.fn.DataTable.isDataTable("#dataTable")){
		 $('#dataTable').dataTable().fnClearTable();
		 $('#dataTable').dataTable().fnDestroy();
	}
	$("tbody").html('');
    var jsonObj = JSON.parse(data);
    for (let option of jsonObj) {
    	let se = (option.sendDriveDate).substring(0,10);
    	let st = (option.sendDriveTime).substring(9,11)+" "+(option.sendDriveTime).substring(0,8);
    	if($("#searchDate").val()==""||$("#searchDate").val()==se){
    	$("tbody").append(`<tr>
    			<td id="od${option.drverOrderId}" style="vertical-align:middle">${option.drverOrderId}</td>
                <td id="md${option.drverOrderId}">${se}</td>
                <td id="dd${option.drverOrderId}">${st}</td>
                <td id="se${option.drverOrderId}">${option.orderAmount}</td>
                <td id="os${option.drverOrderId}">
                ${option.orderStatus=="0"?"å¾…åŸ·è¡Œ":""}
                ${option.orderStatus=="1"?"åŸ·è¡Œä¸­":""}
                ${option.orderStatus=="2"?"å·²å®Œæˆ":""}
                ${option.orderStatus=="3"?"å·²çµå–®":""}
                ${option.orderStatus=="4"?"å–æ¶ˆç”³è«‹ä¸­":""}
                ${option.orderStatus=="5"?"å·²å–æ¶ˆ":""}
                </td>
                <td id="ue${option.drverOrderId}" ondblclick="hi(this)"></td>
                <td><input type="button" class="mybtn" id="del${option.drverOrderId}" value="âŒ" style="border-radius: 0.35rem" onclick="delItem(this)"></td>
                <td><input type="button" class="mybtn" id="ser${option.drverOrderId}" value="ğŸ“ƒ" style="border-radius: 0.35rem" onclick="serItem(this)"></td>
                </tr>`);
         if(option.orderStatus !== "0"){
         	$("#del"+option.drverOrderId).remove();
         } 
         if(option.driveFeedback == null){
        	 $("#ue"+option.drverOrderId).html(`<input type="button" class="mybtn" id="fbk${option.drverOrderId}" value="æ–°å¢å‚™è¨»" style="border-radius: 0.35rem" onclick="myFbk(this)">`);
         }else{
        	 $("#ue"+option.drverOrderId).html(`<input type="button" class="mybtn" id="fbk${option.drverOrderId}" value="ä¿®æ”¹å‚™è¨»" style="border-radius: 0.35rem" onclick="myFbk(this)">`);
         }
    	}
    }
    $("#dataTable").DataTable({
        language: {
            url: '//cdn.datatables.net/plug-ins/1.11.4/i18n/zh_Hant.json'
        },
        pagingType: "full_numbers",
        orderable : false,
        retrieve: true,
    });
}


function delItem(item) {
		let i = item.id.substring(3);
        	$.ajax({
                url: "driveorder.do?search=updateS4"+i, /*GETæ ¼å¼*/
                type: "GET",
            	success: function (data) {
                	getData(data);
                }
        	});
}

function serItem(item) {
	let i = item.id.substring(3);
    $.ajax({
        url: "driveorder.do?search=orderId"+i, /*GETæ ¼å¼*/
        type: "GET",
        success: function (data) {
        	$("#orderInfo").css({
        		"background-color": "white",
        		"border":"1px solid black",
        		"text-align":"center",
        		"width":"600px",
        		"height":"450px",
        		"position":"fixed",
        		"top":"15%",
        		"left":"50%",
        		"margin-left":"-300px"
        	});
            var jsonObj = JSON.parse(data);
            for (let option of jsonObj) {
            	let se = (option.sendDriveDate).substring(0,10);
            	let st = (option.sendDriveTime).substring(9,11)+" "+(option.sendDriveTime).substring(0,8);
            	$("#orderInfo").html(`
        				<table width="100%" height="100%">
            			<tr><th>è¨‚å–®ç·¨è™Ÿ</th><td>${option.drverOrderId}</td></tr>
            			<tr><th>å¸æ©ŸID</th><td>${option.driverId}</td></tr>
            			<tr><th>å‡ºç™¼é»</th><td>${option.startPoint}</td></tr>
            			<tr><th>ç›®çš„åœ°</th><td>${option.endPoint}</td></tr>
            			<tr><th>é è¨ˆé‡Œç¨‹æ•¸</th><td>${option.distance}</td></tr>
            			<tr><th>è¨‚å–®é‡‘é¡</th><td>${option.orderAmount}</td></tr>
            			<tr><th>æ´¾è»Šæ—¥æœŸ</th><td>${se}</td></tr>
            			<tr><th>æ´¾è»Šæ™‚é–“</th><td>${st}</td></tr>
            			<tr><th>è¯çµ¡äººå§“å</th><td>${option.contactName}</td></tr>
            			<tr><th>è¯çµ¡é›»è©±</th><td>${option.contactNumber}</td></tr>
            			<tr><th>è¨‚å–®ç‹€æ…‹</th><td>
            			${option.orderStatus=="0"?"å¾…åŸ·è¡Œ":""}
                        ${option.orderStatus=="1"?"åŸ·è¡Œä¸­":""}
                        ${option.orderStatus=="2"?"å·²å®Œæˆ":""}
                        ${option.orderStatus=="3"?"å·²çµå–®":""}
                        ${option.orderStatus=="4"?"å–æ¶ˆç”³è«‹ä¸­":""}
                        ${option.orderStatus=="5"?"å·²å–æ¶ˆ":""}
                        </td></tr>
            			<tr><th>å‚™è¨»</th><td>${option.driveFeedback==null?"å°šæœªå¡«å¯«":(option.driveFeedback)}</td></tr>
            			<tr><th> </th><td><input type="button" class="mybtn" value="ç¢ºå®š" onclick="clearInfo()"></td></tr>
            			</table>`);
            }
        }
    });
}
function myFbk(item) {
	let i = item.id.substring(3);
    $.ajax({
        url: "driveorder.do?search=orderId"+i, /*GETæ ¼å¼*/
        type: "GET",
        success: function (data) {
        	$("#orderInfo").css({
        		"background-color": "white",
        		"border":"1px solid black",
        		"text-align":"center",
        		"width":"300px",
        		"height":"400px",
        		"z-index":"77",
        		"position":"fixed",
        		"top":"15%",
        		"left":"50%",
        		"margin-left":"-150px"
        	});
            var jsonObj = JSON.parse(data);
            for (let option of jsonObj) {
            	$("#orderInfo").html(`
        				<table width="100%" height="100%">
            			<thead bgcolor="#dedede"><tr><th>æˆ‘çš„è¨‚å–®å‚™è¨»</th></tr></thead>
            			<tbody height="80%"><tr>
            			<td id="fb${i}" contenteditable="true" valign="top" align="left" style="word-break: break-all">
            			${option.driveFeedback == null? "": option.driveFeedback}
            			</td></tr></tbody>
            			<tfoot bgcolor="#dedede"><tr><th>
            			<input type="button" value="å–æ¶ˆ" onclick="clearInfo()">
            			<input type="button" value="ç¢ºå®š" onclick="edtFbk(${i})">
            			</th></tr></tfoot>
            			</table>`);
            }
        }
    });
}

function edtFbk(i){
	console.log($("#fb"+i).text());
	$.ajax({
        url: "driveorder.do?search="+i+"feedback"+$("#fb"+i).text(), /*GETæ ¼å¼*/
        type: "GET",
        success: function (data) {
            getData(data);
        }
    });
	$("#orderInfo").html('');
	$("#orderInfo").removeAttr("style","");
}

function clearInfo(){
	$("#orderInfo").html(''); //innerHTML
	$("#orderInfo").removeAttr("style",""); //Attritue
}

</script>

</html>